/*
 * svg-path-helper v1.0.0
 * Copyright Â© 2023 o0sh4d0w0o
 * Released under the MIT license
 * @copyright
*/
this["svg-path-helper"]=this["svg-path-helper"]||{},this["svg-path-helper"].js=function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function e(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,v(i.key),i)}}function r(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){return(e=v(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function u(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=c(t);if(e){var s=c(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return u(this,n)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,s,r,a,o=[],c=!0,h=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=r.call(n)).done)&&(o.push(i.value),o.length!==e);c=!0);}catch(t){h=!0,s=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(h)throw s}}return o}}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function p(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=y(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){o=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw r}}}}function v(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function g(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElementNS("http://www.w3.org/2000/svg",t),i=0,s=Object.entries(e);i<s.length;i++){var r=d(s[i],2),a=r[0],o=r[1];n.setAttribute(a,o)}return n}function k(){var t=Date.now().toString(36);return Math.random().toString(36).replace(/0?\./g,"")+t+crypto.getRandomValues(new BigUint64Array(1))[0].toString(36)}function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return parseFloat(t.toFixed(e))}function b(t){for(var e=[],n=t.parentElement;n;)"svg"===n.tagName.toLowerCase()&&e.push(n),n=n.parentElement;return e}function P(t){var e=window.getComputedStyle(t),n=t.getBoundingClientRect(),i=t.getAttribute("viewBox"),s=parseFloat(e.width),r=parseFloat(e.height);if(!i)return{scale:{x:1,y:1},offset:{x:0,y:0},bounding:n};var a=d(i.split(" ").map(Number),4),o=a[0],c=a[1],h=a[2],u=a[3],l=t.getAttribute("preserveAspectRatio"),f=l?l.trim():"xMidYMid meet",y=t.width.baseVal.value,m=t.height.baseVal.value;if(s!==y&&"auto"!==e.width&&""!==e.width&&(y=s),r!==m&&"auto"!==e.height&&""!==e.height&&(m=r),f.includes("none"))return{scale:{x:h/y,y:u/m},offset:{x:0,y:0},bounding:n};var p=f.includes("slice"),v=h/u>y/m,g=v?h/y:u/m,k=v?u/m:h/y,x=p?k:g,b=p?k:g,P={xMin:0,xMid:(h-y*x)/2,xMax:h-y*x,yMin:0,yMid:(u-m*b)/2,yMax:u-m*b},A=f.match(/x(Min|Mid|Max)Y(Min|Mid|Max)/),w=A[1]||"Mid",S=A[2]||"Mid";return{scale:{x:x,y:b},offset:{x:o+P["x".concat(w)],y:c+P["y".concat(S)]},bounding:n}}var A={GET:/[MLHVCSQTAZ]\s?(?:(?:-?[0-9]*\.?[0-9]+)?(?:\s|$)?)+/gi,RELATIVE:/[mlhvcsqtaz]/,PARAMS:/-?[0-9]*\.?[0-9]+/g},w={M:["x","y"],L:["x","y"],T:["x","y"],H:["x"],V:["y"],S:["x1","y1","x","y"],Q:["x1","y1","x","y"],C:["x1","y1","x2","y2","x","y"],A:["rx","ry","angle","large","sweep","x","y"]},S={M:2,L:2,T:2,H:1,V:1,S:4,Q:4,C:6,A:7,Z:0};var E=function(){function t(n){i(this,t),this.options=e({name:"?",parameters:{},relative:!1,implicit:!1,lastCommand:null},n),this.name=this.options.name,this.verticalOnly="V"===this.name,this.horizontalOnly="H"===this.name,this.parameters=e({},this.options.parameters),this.relative=this.options.relative,this.implicit=this.options.implicit,this.lastCommand=this.options.lastCommand,this.update()}return r(t,[{key:"endPosition",get:function(){if(!this.lastCommand)return{x:this.parameters.x,y:this.parameters.y};var t=this.lastCommand.endPosition,e=!1===this.relative?0:t.x,n=!1===this.relative?0:t.y;return S[this.name]>1?{x:e+this.parameters.x,y:n+this.parameters.y}:1===S[this.name]&&this.horizontalOnly?{x:e+this.parameters.x,y:n}:1===S[this.name]&&this.verticalOnly?{x:e,y:n+this.parameters.y}:t}},{key:"getEndPos",value:function(){var t;return(null===(t=this.lastCommand)||void 0===t?void 0:t.endPosition)||{x:0,y:0}}},{key:"getAbsolute",value:function(){if(this.update(),!this.relative)return this.parameters;var t=e({},this.parameters);for(var n in t)t[n]=this.getValue(t[n],n,!0);return t}},{key:"getRelative",value:function(){if(this.update(),this.relative)return this.parameters;var t=e({},this.parameters);for(var n in t)t[n]=this.getValue(t[n],n,!1);return t}},{key:"getValue",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.relative,i=this.getEndPos(),s=e.includes("x"),r=e.includes("y"),a=e.includes("r");if(a&&s||a&&r)return t;if(n){if(s)return t+i.x;if(r)return t+i.y}else{if(s)return t-i.x;if(r)return t-i.y}return t}},{key:"setValue",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var i=n!==this.relative;this.parameters[e]=i?this.getValue(t,e,n):t}}},{key:"update",value:function(){this.verticalOnly&&this.setValue(this.getEndPos().x,"x"),this.horizontalOnly&&this.setValue(this.getEndPos().y,"y")}}]),t}(),L=function(){function t(e){i(this,t),this.path=e,this.list=[],this.parse()}return r(t,[{key:"parse",value:function(){var t,e=this,n=(t=this.path,t.replace(/[^0-9A-Z-.]/gi," ").trim().replace(/\s+/g," ")).match(A.GET),i=null;null==n||n.forEach((function(t){var n,s=A.RELATIVE.test(t[0]),r=t[0].toUpperCase(),a=f((null===(n=t.match(A.PARAMS))||void 0===n?void 0:n.map(parseFloat))||[]),o=!0,c=function(){var t,n=a.splice(0,S[r]),c={};null===(t=w[r])||void 0===t||t.forEach((function(t,e){c[t]=n[e]}));var h=new E({name:r,parameters:c,relative:s,implicit:!o,lastCommand:i});i=h,e.list.push(h),o=!1};do{c()}while(a.length>0)}))}},{key:"build",value:function(){return this.list.map((function(t){var e,n=t.relative?t.name.toLowerCase():t.name,i=t.relative?t.getRelative():t.getAbsolute(),s=(null===(e=w[t.name])||void 0===e?void 0:e.map((function(t){return x(i[t])})).join(" "))||"";return"".concat(t.implicit?"":n).concat(s)})).join(" ")}}]),t}(),M=function(){function t(e,n,s,r){i(this,t),this.element=null,this.id=k(),this.x=e,this.y=n,this.size=x(s),this.command=r.command,this.commandParams=r.params,this.isAngle=this.commandParams.angle,this.isHorizontal="V"!==this.command.name&&this.commandParams.x,this.isVertical="H"!==this.command.name&&this.commandParams.y,this.links=[],this.arcs=[],this.active=!1,this.create(),this.set()}return r(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=x(t)}},{key:"y",get:function(){return this._y},set:function(t){this._y=x(t)}},{key:"addLink",value:function(t){this.links.push(t)}},{key:"addArc",value:function(t){this.arcs.push(t)}},{key:"create",value:function(){this.element=g("circle",{r:this.size,"stroke-width":x(1.25*this.size)}),this.element.classList.add("spe-point"),this.applyClasses()}},{key:"applyClasses",value:function(){var t,e=[];(this.isAngle&&e.push("angle"),!this.isVertical||this.isHorizontal||this.isAngle||e.push("vertical"),!this.isHorizontal||this.isVertical||this.isAngle||e.push("horizontal"),e.length>0)&&(t=this.element.classList).add.apply(t,e);return e}},{key:"set",value:function(){this.element.setAttribute("cx",this.x),this.element.setAttribute("cy",this.y),this.update()}},{key:"update",value:function(){this.links.forEach((function(t){t.set()})),this.arcs.forEach((function(t){t.set()})),this.command.setValue(this.x,this.commandParams.x),this.command.setValue(this.y,this.commandParams.y),this.commandParams.angle&&this.command.setValue(this.angle,this.commandParams.angle)}},{key:"linkedTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(e.has(this))return!1;e.add(this);var n,i=p(this.links);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s.p1===t||s.p2===t)return!0;if(s.p1.linkedTo(t,e))return!0;if(s.p2.linkedTo(t,e))return!0}}catch(t){i.e(t)}finally{i.f()}var r,a=p(this.arcs);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.p1===t||o.p2===t)return!0;if(o.p1.linkedTo(t,e))return!0;if(o.p2.linkedTo(t,e))return!0}}catch(t){a.e(t)}finally{a.f()}return!1}},{key:"select",value:function(){this.active||(this.active=!0,this.element.classList.add("active"),this.links.forEach((function(t){t.select()})),this.arcs.forEach((function(t){t.select()})))}},{key:"unSelect",value:function(){this.active&&(this.active=!1,this.element.classList.remove("active"),this.links.forEach((function(t){t.unSelect()})),this.arcs.forEach((function(t){t.unSelect()})))}}]),t}(),O=function(t){o(n,t);var e=l(n);function n(t,s,r){var a;return i(this,n),(a=e.call(this,0,0,s,r)).angle=a.command.parameters.angle,a.x=a.command.parameters.rx,a.y=a.command.parameters.ry,a.centerPoint=t,a.set(),a}return r(n,[{key:"getArcRx",value:function(){return this.isAngle?this.x:this.isHorizontal?x(this.centerPoint.x+this.x):this.centerPoint.x}},{key:"getArcRy",value:function(){return this.isAngle?this.y:this.isVertical?x(this.centerPoint.y+this.y):this.centerPoint.y}},{key:"create",value:function(){this.element=g("circle",{r:this.size}),this.element.classList.add("spe-arc-point"),this.applyClasses()}},{key:"set",value:function(){if(this.centerPoint){if(this.isAngle){var t=(e=this.centerPoint,n=this.angle,i=10,s=(n-90)*(Math.PI/180),{x:e.x+i*Math.cos(s),y:e.y+i*Math.sin(s)});this.x=t.x,this.y=t.y}var e,n,i,s;this.element.setAttribute("cx",this.getArcRx()),this.element.setAttribute("cy",this.getArcRy()),this.update()}}}]),n}(M),C=function(){function t(e,n,s,r){i(this,t),this.element=null,this.elements={},this.id=k(),this.p1=e,this.p2=n,this.size=x(.3*s),this.selectedSize=x(s),this.command=r.command,this.commandParams=r.params,this.active=!1,e.addArc(this),n.addArc(this),this.create(),this.set()}return r(t,[{key:"triggerLarge",value:function(){this.command.parameters.large=Number(!this.command.parameters.large),this.set()}},{key:"triggerSweep",value:function(){this.command.parameters.sweep=Number(!this.command.parameters.sweep),this.set()}},{key:"create",value:function(){var t=g("g"),e=g("path",{"stroke-width":this.size}),n=g("path",{"stroke-width":this.size}),i=g("path",{"stroke-width":this.size}),s=g("path",{"stroke-width":this.size});t.classList.add("spe-arc-wrapper"),e.classList.add("spe-arc","sweep","large"),e.classList.add("spe-arc","sweep","large"),n.classList.add("spe-arc","sweep"),i.classList.add("spe-arc"),s.classList.add("spe-arc","large"),t.append(e,n,i,s),this.element=t,this.elements.arcSweepLarge=e,this.elements.arcSweep=n,this.elements.arc=i,this.elements.arcLarge=s}},{key:"set",value:function(){var t=this.command.parameters,e=t.sweep,n=t.large;for(var i in this.elements)this.elements[i].classList.remove("selected"),this.elements[i].setAttribute("stroke-width",this.size);var s=null;e&&n&&(s=this.elements.arcSweepLarge),e&&!n&&(s=this.elements.arcSweep),e||n||(s=this.elements.arc),!e&&n&&(s=this.elements.arcLarge),s.classList.add("selected"),s.setAttribute("stroke-width",this.selectedSize),this.element.append(s),this.elements.arcSweepLarge.setAttribute("d",this.getArc(1,1)),this.elements.arcSweep.setAttribute("d",this.getArc(0,1)),this.elements.arc.setAttribute("d",this.getArc(0,0)),this.elements.arcLarge.setAttribute("d",this.getArc(1,0))}},{key:"getArc",value:function(t,e){var n=this.p1,i=this.p2,s=this.command.parameters,r=s.rx,a=s.ry,o=s.angle;return"M".concat(i.x," ").concat(i.y," A").concat(r," ").concat(a," ").concat(o," ").concat(t," ").concat(e," ").concat(n.x," ").concat(n.y)}},{key:"select",value:function(){this.active||(this.active=!0,this.element.classList.add("active"),this.p1.select(),this.p2.select())}},{key:"unSelect",value:function(){this.active&&(this.active=!1,this.element.classList.remove("active"),this.p1.unSelect(),this.p2.unSelect())}}]),t}(),z=function(t){o(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return r(n,[{key:"create",value:function(){this.element=g("circle",{r:this.size}),this.element.classList.add("spe-curve-point"),this.applyClasses()}}]),n}(M),j=function(t){o(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return r(n,[{key:"create",value:function(){this.element=g("rect",{width:this.size,height:this.size,"stroke-width":.5*this.size}),this.element.classList.add("spe-end-point"),this.applyClasses()}},{key:"set",value:function(){var t=x(this.size/2);this.element.setAttribute("x",x(this.x-t)),this.element.setAttribute("y",x(this.y-t)),this.update()}}]),n}(M),D=function(){function t(e,n,s){i(this,t),this.element=null,this.id=k(),this.p1=e,this.p2=n,this.size=x(s),this.active=!1,e.addLink(this),n.addLink(this),this.create(),this.set()}return r(t,[{key:"create",value:function(){this.element=g("line",{"stroke-width":this.size}),this.element.classList.add("spe-link")}},{key:"set",value:function(){var t=this.p1.getArcRx?this.p1.getArcRx():this.p1.x,e=this.p1.getArcRy?this.p1.getArcRy():this.p1.y,n=this.p2.getArcRx?this.p2.getArcRx():this.p2.x,i=this.p2.getArcRy?this.p2.getArcRy():this.p2.y;this.element.setAttribute("x1",t),this.element.setAttribute("y1",e),this.element.setAttribute("x2",n),this.element.setAttribute("y2",i)}},{key:"select",value:function(){this.active||(this.active=!0,this.element.classList.add("active"),this.p1.select(),this.p2.select())}},{key:"unSelect",value:function(){this.active&&(this.active=!1,this.element.classList.remove("active"),this.p1.unSelect(),this.p2.unSelect())}}]),t}(),R=function(){function t(e){i(this,t),this.element=null,this.id=k(),this.x=0,this.y=0,this.size=1,this.points=[],this.curvePoints=[],this.arcPoints=[],this.links=[],this.arcs=[],this.active=!1,this.lastPoint=null,this.lastModifier=null,this.create(e),this.set()}return r(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=x(t)}},{key:"y",get:function(){return this._y},set:function(t){this._y=x(t)}},{key:"create",value:function(t){var e=window.getComputedStyle(t),n=t.cloneNode(),i=n.getAttributeNames(),s=parseFloat(e.strokeWidth);s&&(this.size=x(s)),i.forEach((function(t){"d"!==t&&n.removeAttribute(t)})),n.setAttribute("class","spe-path"),n.setAttribute("stroke-width",this.size),this.element=n}},{key:"addPoint",value:function(t){t&&(this.points.push(t),this.lastPoint=t)}},{key:"addCurvePoint",value:function(t){t&&(this.curvePoints.push(t),this.lastModifier=t)}},{key:"addArcPoint",value:function(t){t&&(this.arcPoints.push(t),this.lastModifier=t)}},{key:"addArc",value:function(t){t&&this.arcs.push(t)}},{key:"addLink",value:function(t){t&&this.links.push(t)}},{key:"getValue",value:function(){return this.element.getAttribute("d")}},{key:"getLastModifier",value:function(){return this.lastModifier}},{key:"getLastPoint",value:function(){return this.lastPoint}},{key:"getAllPoints",value:function(){return[].concat(f(this.points),f(this.curvePoints),f(this.arcPoints))}},{key:"getElements",value:function(){return[].concat(f(this.arcs),f(this.links),f(this.getAllPoints()))}},{key:"setValue",value:function(t){this.element.setAttribute("d",t)}},{key:"set",value:function(){var t=this;this.points.forEach((function(e){e.x+=t.x,e.y+=t.y,e.set()})),this.curvePoints.forEach((function(e){e.x+=t.x,e.y+=t.y,e.set()}))}},{key:"select",value:function(){this.active||(this.active=!0,this.element.classList.add("active"))}},{key:"unSelect",value:function(){this.active&&(this.active=!1,this.element.classList.remove("active"))}}]),t}(),H=function(t){o(n,t);var e=l(n);function n(){return i(this,n),e.apply(this,arguments)}return r(n,[{key:"create",value:function(){this.element=g("polygon",{"stroke-width":.5*this.size}),this.element.classList.add("spe-start-point"),this.applyClasses()}},{key:"set",value:function(){var t=x(this.size/2),e="".concat(x(this.x-t)," ").concat(this.y),n="".concat(this.x," ").concat(x(this.y+t)),i="".concat(x(this.x+t)," ").concat(this.y),s="".concat(this.x," ").concat(x(this.y-t));this.element.setAttribute("points","".concat(e,", ").concat(n,", ").concat(i,", ").concat(s)),this.update()}}]),n}(M),V=function(){function t(){i(this,t),this.history={undo:[],redo:[]},this.historyIndex=-1,this.current=null}return r(t,[{key:"add",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"undo";if(t){var i=[],s=[];Array.isArray(t)?i=t:i.push(t),this.current=this.current||{},i.forEach((function(t){var n={target:t,position:{x:t.x||null,y:t.y||null},angle:t.angle,command:e({},t.command.parameters)};s.push(n)})),this.current[n]=s}}},{key:"undo",value:function(){this.canUndo()&&(this.restore(this.history.undo[this.historyIndex]),this.historyIndex--)}},{key:"redo",value:function(){this.canRedo()&&(this.historyIndex++,this.restore(this.history.redo[this.historyIndex]))}},{key:"restore",value:function(t){t&&t.forEach((function(t){var e=t.target;for(var n in e.x=t.position.x,e.y=t.position.y,e.angle=t.angle,e.command.parameters)e.command.parameters[n]=t.command[n];e.set()}))}},{key:"isDataChanged",value:function(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!0;for(var i=0;i<t.length;i++)if(this.isDataChanged(t[i],e[i]))return!0;return!1}if(t&&"object"===n(t)&&e&&"object"===n(e)){var s=Object.keys(t),r=Object.keys(e);if(s.length!==r.length)return!0;for(var a=0,o=s;a<o.length;a++){var c=o[a];if("target"!==c&&this.isDataChanged(t[c],e[c]))return!0}return!1}return t!==e}},{key:"save",value:function(){if(this.current){var t=this.current.undo.map((function(t){return t.target}));this.add(t,"redo");var e=this.history.undo[this.historyIndex-1],n=!e||this.isDataChanged(this.current.undo,e),i=this.isDataChanged(this.current.undo,this.current.redo);n&&i&&(this.historyIndex<this.history.undo.length-1&&(this.history.undo=this.history.undo.slice(0,this.historyIndex+1),this.history.redo=this.history.redo.slice(0,this.historyIndex+1)),this.history.undo.push(this.current.undo),this.history.redo.push(this.current.redo),this.historyIndex++),this.current=null}}},{key:"canUndo",value:function(){return this.historyIndex>=0}},{key:"canRedo",value:function(){return this.historyIndex<this.history.redo.length-1}}]),t}(),I=function(){function t(n){i(this,t),t.instances.push(this),this.options=e({container:null,path:null},n),this.path=this.options.path,this.container=this.options.container,this.keyModifierPressed={},this.pointDragging={active:!1,target:null},this.pathDragging={active:!1},this.elements={svgParents:b(this.container)},this.history=new V,this.pathSize=0,this.snapRotation=90,this.snapDistance=5,this.init()}return r(t,[{key:"isActive",value:function(){var t=this.elements.path;if(t.active)return!0;var e,n=p(t.points);try{for(n.s();!(e=n.n()).done;){if(e.value.active)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"init",value:function(){1===t.instances.length&&(document.addEventListener("mousedown",t.handleMouseDown),document.addEventListener("mousemove",t.handleMouseMove),document.addEventListener("mouseup",t.handleMouseUp),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp));var e=this.createEditor();this.elements.element=e.element,this.elements.path=e.path}},{key:"createEditor",value:function(){var e=g("g"),n=new R(this.path);return e.classList.add(t.CLASSNAME),e.appendChild(n.element),{element:e,path:n}}},{key:"setScaleAndOffset",value:function(){for(var t=P(this.container),e=this.elements.svgParents.length-1;0===e;e--){var n=P(this.elements.svgParents[e]);t.scale.x*=n.scale.x,t.scale.y*=n.scale.y,t.offset.x=t.offset.x*n.scale.x+n.offset.x,t.offset.y=t.offset.y*n.scale.y+n.offset.y}this.scale=t.scale,this.viewBoxOffset=t.offset,this.bounding=t.bounding}},{key:"getPoint",value:function(t){var e,n=p(this.elements.path.getAllPoints());try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.element===t)return i}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"getPath",value:function(t){var e=this.elements.path;return e.element===t&&e}},{key:"snapAngle",value:function(t){var e=t%this.snapRotation;return e<this.snapDistance?t-e:this.snapRotation-e<this.snapDistance?t+(this.snapRotation-e):t}},{key:"getScaledPosition",value:function(t){return{x:(t.clientX-this.bounding.left)*this.scale.x+this.viewBoxOffset.x,y:(t.clientY-this.bounding.top)*this.scale.y+this.viewBoxOffset.y}}},{key:"onMouseDown",value:function(t){if(2===t.button)return!1;var e=this.getPoint(t.target),n=this.getPath(t.target);if(this.elements.path.points.forEach((function(t){e&&(e===t||e.linkedTo(t))?t.select():t.unSelect()})),n||this.elements.path.unSelect(),!e&&!n)return!1;this.setScaleAndOffset();var i=this.getScaledPosition(t);n?(n.select(),this.pathDragging={active:!0,target:n,offsetX:i.x,offsetY:i.y},this.history.add(n.points)):(this.elements.path.unSelect(),this.pointDragging={active:!0,target:e,offsetX:i.x-e.x,offsetY:i.y-e.y},this.history.add(e))}},{key:"onMouseMove",value:function(t){var e=this.pathDragging.active,n=e?this.pathDragging:this.pointDragging;if(n.active){var i,s,r,a,o,c=n.target,h=this.getScaledPosition(t),u=h.x-n.offsetX,l=h.y-n.offsetY;e?(c.x=this.keyModifierPressed.alt?0:u,c.y=this.keyModifierPressed.shift?0:l,c.set(),n.offsetX=h.x,n.offsetY=h.y):(c.isHorizontal&&!this.keyModifierPressed.alt&&(c.x=u),c.isVertical&&!this.keyModifierPressed.shift&&(c.y=l),c.isAngle&&(c.angle=this.snapAngle((i=c.centerPoint,r=(s={x:u,y:l}).x-i.x,a=s.y-i.y,(o=(Math.atan2(a,r)*(180/Math.PI)+90)%360)<0?o+360:o))),c.set()),this.updatePath()}}},{key:"onMouseUp",value:function(t){var e=this.getPoint(t.target);2===t.button?this.onContextMenu(e):(this.pathDragging={active:!1,target:null,offsetX:0,offsetY:0},this.pointDragging={active:!1,target:null,offsetX:0,offsetY:0}),this.history.save()}},{key:"onContextMenu",value:function(t){var e=this;t&&t.active&&(this.keyModifierPressed.shift?t.arcs.forEach((function(n){n.p1===t&&(e.history.add(n),n.triggerSweep())})):(this.history.add(t),t.arcs.forEach((function(n){n.p1===t&&(e.history.add(n),n.triggerLarge())}))),this.updatePath())}},{key:"onKeyDown",value:function(t){var e=t.ctrlKey,n=t.shiftKey,i=this.keyModifierPressed,s=i.shift,r=i.z,a=i.y,o=i.c,c=this.elements.path,h=t.key.toLowerCase(),u=this.isActive();this.updateKeyModifiers(t),e&&"c"===h&&u&&!o?function(t){if(navigator.clipboard)return navigator.clipboard.writeText(t);var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select();try{var n=document.execCommand("copy");return document.body.removeChild(e),n?Promise.resolve():Promise.reject()}catch(t){return document.body.removeChild(e),Promise.reject(t)}}(c.getValue()):e&&"z"===h&&u&&!r?(this.history.undo(),this.updatePath()):e&&"y"===h&&u&&!a?(this.history.redo(),this.updatePath()):e&&n&&!s&&this.togglePointsSelection()}},{key:"onKeyUp",value:function(t){this.updateKeyModifiers(t)}},{key:"updateKeyModifiers",value:function(t){var n=t.ctrlKey,i=t.shiftKey,s=t.altKey,r=t.key.toLowerCase();s&&t.preventDefault(),this.keyModifierPressed=e(e({},this.keyModifierPressed),{},a({ctrl:n,shift:i,alt:s},r,"keydown"===t.type))}},{key:"togglePointsSelection",value:function(){var t=this.elements.path,e=t.points.filter((function(t){return t.active})).length===t.points.length;t.points.forEach((function(n){e?n.unSelect():(t.unSelect(),n.select())}))}},{key:"updatePath",value:function(){var t=this.elements.path,e=this.options.commands;t.getAllPoints().forEach((function(t){var e=t.command.getAbsolute(),n=t.commandParams;n.x&&(t.x=e[n.x]),n.y&&(t.y=e[n.y]),t.set()})),this.elements.path.setValue(e.build())}},{key:"addStartPoint",value:function(t,e,n){var i=this.elements.path,s=new H(t,e,1.5*i.size,n);i.addPoint(s)}},{key:"addEndPoint",value:function(t,e,n){var i=this.elements.path,s=new j(t,e,1.2*i.size,n);i.addPoint(s)}},{key:"addPoint",value:function(t,e,n){var i=this.elements.path,s=new M(t,e,.8*i.size,n);i.addPoint(s)}},{key:"addCurvePoint",value:function(t,e,n){var i=this.elements.path,s=new z(t,e,.6*i.size,n);i.addCurvePoint(s)}},{key:"addArcPoint",value:function(t,e){var n=this.elements.path,i=new O(t,.6*n.size,e);n.addArcPoint(i)}},{key:"addArc",value:function(t,e,n){var i=this.elements.path,s=new C(t,e,i.size,n);i.addArc(s)}},{key:"addLink",value:function(){var t=this.elements.path,e=[t.getLastModifier(),t.getLastPoint()],n=new D(e[0],e[1],.9*t.size);t.addLink(n)}},{key:"build",value:function(){var t=this.elements,e=t.element;t.path.getElements().forEach((function(t){e.append(t.element)})),this.container.append(e)}},{key:"destroy",value:function(){0===t.instances.length&&(document.removeEventListener("mousedown",t.handleMouseDown),document.removeEventListener("mousemove",t.handleMouseMove),document.removeEventListener("mouseup",t.handleMouseUp),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp)),this.elements.element.remove()}}],[{key:"handleMouseDown",value:function(e){t.instances.forEach((function(t){return t.onMouseDown(e)}))}},{key:"handleMouseMove",value:function(e){t.instances.forEach((function(t){return t.onMouseMove(e)}))}},{key:"handleMouseUp",value:function(e){t.instances.forEach((function(t){return t.onMouseUp(e)}))}},{key:"handleKeyDown",value:function(e){t.instances.forEach((function(t){return t.onKeyDown(e)}))}},{key:"handleKeyUp",value:function(e){t.instances.forEach((function(t){return t.onKeyUp(e)}))}}]),t}();a(I,"CLASSNAME","svg-path-editor"),a(I,"instances",[]);var T="svg-path-helper",K=null,B=function(){function t(){if(i(this,t),K)return K;this.commandHandlers=this.initCommandHandlers(),this.list=[],this.current={},K=this}return r(t,[{key:"getPaths",value:function(t){var e=this,n=Array.from(t.querySelectorAll("path"));return(n=n.filter((function(n){if(n.closest(".".concat(I.CLASSNAME)))return!1;if(n.closest("svg")!==t)return!1;var i,s=p(e.list);try{for(s.s();!(i=s.n()).done;){if(i.value.paths.filter((function(t){return t.element===n})).length>0)return!1}}catch(t){s.e(t)}finally{s.f()}return!0}))).map(_).filter(Boolean)}},{key:"add",value:function(t){var e,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k(),s=[];t instanceof SVGElement&&t.classList.contains(T)?s.push({name:i,container:t,element:t,paths:this.getPaths(t)}):t.querySelectorAll("svg.".concat(T,", svg.").concat(T," svg")).forEach((function(e){s.push({name:i,container:t,element:e,paths:n.getPaths(e)})})),s=s.filter((function(t){return t.element&&t.paths.length>0})),(e=this.list).push.apply(e,f(s)),this.draw(s)}},{key:"remove",value:function(t){var e=this;this.list.forEach((function(n){n.container===t&&e.removeByHelper(n)}))}},{key:"removeByName",value:function(t){var e=this;this.list.forEach((function(n){n.name===t&&e.removeByHelper(n)}))}},{key:"removeByPath",value:function(t){this.list.forEach((function(e){e.paths.forEach((function(e){e.element===t&&e.editor.destroy()}))}))}},{key:"removeByHelper",value:function(t){var e=this.list.indexOf(t);e>-1&&(t.paths.forEach((function(t){return t.editor.destroy()})),this.list.splice(e,1))}},{key:"clear",value:function(){var t=this;this.list.forEach((function(e){return t.removeByHelper(e)})),this.list.length=0}},{key:"initCommandHandlers",value:function(){return{M:this.pointHandler,L:this.pointHandler,T:this.pointHandler,H:this.pointHandler,V:this.pointHandler,S:this.curveHandler,Q:this.curveHandler,C:this.cubicBezierHandler,A:this.arcHandler}}},{key:"draw",value:function(t){var e=this;t.forEach((function(t){t.paths.forEach((function(t){return e.drawPath(t)}))}))}},{key:"drawPath",value:function(t){var e=this,n=t.element,i=new I({container:n.parentNode,path:n,commands:t.commands}),s=t.commands.list.length;t.commands.list.forEach((function(t,n){var r=e.commandHandlers[t.name];e.current={command:t,index:n,editor:i,length:s},r&&r.call(e)})),i.build(),t.editor=i}},{key:"pointHandler",value:function(){var t=this.current.command,e=t.getAbsolute(),n=e.x,i=e.y;this.addPoint(n,i,{command:t,params:{x:"x",y:"y"}})}},{key:"curveHandler",value:function(){var t=this.current,e=t.command,n=t.editor,i=e.getAbsolute(),s=i.x,r=i.y,a=i.x1,o=i.y1;n.addCurvePoint(a,o,{command:e,params:{x:"x1",y:"y1"}}),this.addPoint(s,r,{command:e,params:{x:"x",y:"y"}}),n.addLink()}},{key:"cubicBezierHandler",value:function(){var t=this.current,e=t.command,n=t.editor,i=e.getAbsolute(),s=i.x,r=i.y,a=i.x1,o=i.y1,c=i.x2,h=i.y2;n.addCurvePoint(a,o,{command:e,params:{x:"x1",y:"y1"}}),n.addLink(),n.addCurvePoint(c,h,{command:e,params:{x:"x2",y:"y2"}}),this.addPoint(s,r,{command:e,params:{x:"x",y:"y"}}),n.addLink()}},{key:"arcHandler",value:function(){var t=this.current,e=t.command,n=t.editor,i=e.getAbsolute(),s=i.x,r=i.y,a=n.elements.path,o=a.getLastPoint();this.addPoint(s,r,{command:e,params:{x:"x",y:"y"}});var c=a.getLastPoint();n.addArc(c,o,{command:e,params:{x:"rx",y:"ry"}}),n.addArcPoint(c,{command:e,params:{x:"rx"}}),n.addLink(),n.addArcPoint(c,{command:e,params:{y:"ry"}}),n.addLink(),n.addArcPoint(c,{command:e,params:{angle:"angle"}}),n.addLink()}},{key:"addPoint",value:function(t,e,n){var i=this.current,s=i.editor,r=i.index,a=i.length;0===r?s.addStartPoint(t,e,n):r===a-1?s.addEndPoint(t,e,n):s.addPoint(t,e,n)}}]),t}();function _(t){var e=t.getAttribute("d");return e&&e.trim()?{element:t,commands:new L(e)}:null}return B}();
