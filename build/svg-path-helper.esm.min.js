/*
 * svg-path-helper.js v1.0.0
 * Copyright Â© 2023 o0sh4d0w0o
 * Released under the MIT license
 * @copyright
*/
function t(t,e={}){const s=document.createElementNS("http://www.w3.org/2000/svg",t);for(const[t,i]of Object.entries(e))s.setAttribute(t,i);return s}function e(){const t=Date.now().toString(36);return Math.random().toString(36).replace(/0?\./g,"")+t+crypto.getRandomValues(new BigUint64Array(1))[0].toString(36)}function s(t,e=4){return parseFloat(t.toFixed(e))}function i(t){const e=[];let s=t.parentElement;for(;s;)"svg"===s.tagName.toLowerCase()&&e.push(s),s=s.parentElement;return e}function n(t){const e=window.getComputedStyle(t),s=t.getBoundingClientRect(),i=t.getAttribute("viewBox"),n=parseFloat(e.width),a=parseFloat(e.height);if(!i)return{scale:{x:1,y:1},offset:{x:0,y:0},bounding:s};const[r,h,o,c]=i.split(" ").map(Number),l=t.getAttribute("preserveAspectRatio"),d=l?l.trim():"xMidYMid meet";let m=t.width.baseVal.value,u=t.height.baseVal.value;n!==m&&"auto"!==e.width&&""!==e.width&&(m=n),a!==u&&"auto"!==e.height&&""!==e.height&&(u=a);if(d.includes("none"))return{scale:{x:o/m,y:c/u},offset:{x:0,y:0},bounding:s};const p=d.includes("slice"),y=o/c>m/u,g=y?o/m:c/u,f=y?c/u:o/m,x=p?f:g,v=p?f:g,A={xMin:0,xMid:(o-m*x)/2,xMax:o-m*x,yMin:0,yMid:(c-u*v)/2,yMax:c-u*v},P=d.match(/x(Min|Mid|Max)Y(Min|Mid|Max)/),w=P[1]||"Mid",L=P[2]||"Mid";return{scale:{x:x,y:v},offset:{x:r+A[`x${w}`],y:h+A[`y${L}`]},bounding:s}}const a={GET:/[MLHVCSQTAZ]\s?(?:(?:-?[0-9]*\.?[0-9]+)?(?:\s|$)?)+/gi,RELATIVE:/[mlhvcsqtaz]/,PARAMS:/-?[0-9]*\.?[0-9]+/g},r={M:["x","y"],L:["x","y"],T:["x","y"],H:["x"],V:["y"],S:["x1","y1","x","y"],Q:["x1","y1","x","y"],C:["x1","y1","x2","y2","x","y"],A:["rx","ry","angle","large","sweep","x","y"]},h={M:2,L:2,T:2,H:1,V:1,S:4,Q:4,C:6,A:7,Z:0};class o{constructor(t){this.options={name:"?",parameters:{},relative:!1,implicit:!1,lastCommand:null,...t},this.name=this.options.name,this.verticalOnly="V"===this.name,this.horizontalOnly="H"===this.name,this.parameters={...this.options.parameters},this.relative=this.options.relative,this.implicit=this.options.implicit,this.lastCommand=this.options.lastCommand,this.update()}get endPosition(){if(!this.lastCommand)return{x:this.parameters.x,y:this.parameters.y};const t=this.lastCommand.endPosition;let e=!1===this.relative?0:t.x,s=!1===this.relative?0:t.y;return h[this.name]>1?{x:e+this.parameters.x,y:s+this.parameters.y}:1===h[this.name]&&this.horizontalOnly?{x:e+this.parameters.x,y:s}:1===h[this.name]&&this.verticalOnly?{x:e,y:s+this.parameters.y}:t}getEndPos(){return this.lastCommand?.endPosition||{x:0,y:0}}getAbsolute(){if(this.update(),!this.relative)return this.parameters;const t={...this.parameters};for(let e in t)t[e]=this.getValue(t[e],e,!0);return t}getRelative(){if(this.update(),this.relative)return this.parameters;const t={...this.parameters};for(let e in t)t[e]=this.getValue(t[e],e,!1);return t}getValue(t,e,s=this.relative){const i=this.getEndPos(),n=e.includes("x"),a=e.includes("y"),r=e.includes("r");if(r&&n||r&&a)return t;if(s){if(n)return t+i.x;if(a)return t+i.y}else{if(n)return t-i.x;if(a)return t-i.y}return t}setValue(t,e,s=!1){if(!e)return;const i=s!==this.relative;this.parameters[e]=i?this.getValue(t,e,s):t}update(){this.verticalOnly&&this.setValue(this.getEndPos().x,"x"),this.horizontalOnly&&this.setValue(this.getEndPos().y,"y")}}class c{constructor(t){this.path=t,this.list=[],this.parse()}parse(){const t=(e=this.path,e.replace(/[^0-9A-Z-.]/gi," ").trim().replace(/\s+/g," ")).match(a.GET);var e;let s=null;t?.forEach((t=>{const e=a.RELATIVE.test(t[0]),i=t[0].toUpperCase();let n=[...t.match(a.PARAMS)?.map(parseFloat)||[]],c=!0;do{const t=n.splice(0,h[i]),a={};r[i]?.forEach(((e,s)=>{a[e]=t[s]}));const l=new o({name:i,parameters:a,relative:e,implicit:!c,lastCommand:s});s=l,this.list.push(l),c=!1}while(n.length>0)}))}build(){return this.list.map((t=>{const e=t.relative?t.name.toLowerCase():t.name,i=t.relative?t.getRelative():t.getAbsolute(),n=r[t.name]?.map((t=>s(i[t]))).join(" ")||"";return`${t.implicit?"":e}${n}`})).join(" ")}}class l{constructor(t,i,n,a){this.element=null,this.id=e(),this.x=t,this.y=i,this.size=s(n),this.command=a.command,this.commandParams=a.params,this.isAngle=this.commandParams.angle,this.isHorizontal="V"!==this.command.name&&this.commandParams.x,this.isVertical="H"!==this.command.name&&this.commandParams.y,this.links=[],this.arcs=[],this.active=!1,this.create(),this.set()}get x(){return this._x}get y(){return this._y}set x(t){this._x=s(t)}set y(t){this._y=s(t)}addLink(t){this.links.push(t)}addArc(t){this.arcs.push(t)}create(){this.element=t("circle",{r:this.size,"stroke-width":s(1.25*this.size)}),this.element.classList.add("spe-point"),this.applyClasses()}applyClasses(){const t=[];return this.isAngle&&t.push("angle"),!this.isVertical||this.isHorizontal||this.isAngle||t.push("vertical"),!this.isHorizontal||this.isVertical||this.isAngle||t.push("horizontal"),t.length>0&&this.element.classList.add(...t),t}set(){this.element.setAttribute("cx",this.x),this.element.setAttribute("cy",this.y),this.update()}update(){this.links.forEach((t=>{t.set()})),this.arcs.forEach((t=>{t.set()})),this.command.setValue(this.x,this.commandParams.x),this.command.setValue(this.y,this.commandParams.y),this.commandParams.angle&&this.command.setValue(this.angle,this.commandParams.angle)}linkedTo(t,e=new Set){if(e.has(this))return!1;e.add(this);for(const s of this.links){if(s.p1===t||s.p2===t)return!0;if(s.p1.linkedTo(t,e))return!0;if(s.p2.linkedTo(t,e))return!0}for(const s of this.arcs){if(s.p1===t||s.p2===t)return!0;if(s.p1.linkedTo(t,e))return!0;if(s.p2.linkedTo(t,e))return!0}return!1}select(){this.active||(this.active=!0,this.element.classList.add("active"),this.links.forEach((t=>{t.select()})),this.arcs.forEach((t=>{t.select()})))}unSelect(){this.active&&(this.active=!1,this.element.classList.remove("active"),this.links.forEach((t=>{t.unSelect()})),this.arcs.forEach((t=>{t.unSelect()})))}}class d extends l{constructor(t,e,s){super(0,0,e,s),this.angle=this.command.parameters.angle,this.x=this.command.parameters.rx,this.y=this.command.parameters.ry,this.centerPoint=t,this.set()}getArcRx(){return this.isAngle?this.x:this.isHorizontal?s(this.centerPoint.x+this.x):this.centerPoint.x}getArcRy(){return this.isAngle?this.y:this.isVertical?s(this.centerPoint.y+this.y):this.centerPoint.y}create(){this.element=t("circle",{r:this.size}),this.element.classList.add("spe-arc-point"),this.applyClasses()}set(){if(this.centerPoint){if(this.isAngle){const t=function(t,e,s){const i=(e-90)*(Math.PI/180);return{x:t.x+s*Math.cos(i),y:t.y+s*Math.sin(i)}}(this.centerPoint,this.angle,10);this.x=t.x,this.y=t.y}this.element.setAttribute("cx",this.getArcRx()),this.element.setAttribute("cy",this.getArcRy()),this.update()}}}class m{constructor(t,i,n,a){this.element=null,this.elements={},this.id=e(),this.p1=t,this.p2=i,this.size=s(.3*n),this.selectedSize=s(n),this.command=a.command,this.commandParams=a.params,this.active=!1,t.addArc(this),i.addArc(this),this.create(),this.set()}triggerLarge(){this.command.parameters.large=Number(!this.command.parameters.large),this.set()}triggerSweep(){this.command.parameters.sweep=Number(!this.command.parameters.sweep),this.set()}create(){const e=t("g"),s=t("path",{"stroke-width":this.size}),i=t("path",{"stroke-width":this.size}),n=t("path",{"stroke-width":this.size}),a=t("path",{"stroke-width":this.size});e.classList.add("spe-arc-wrapper"),s.classList.add("spe-arc","sweep","large"),s.classList.add("spe-arc","sweep","large"),i.classList.add("spe-arc","sweep"),n.classList.add("spe-arc"),a.classList.add("spe-arc","large"),e.append(s,i,n,a),this.element=e,this.elements.arcSweepLarge=s,this.elements.arcSweep=i,this.elements.arc=n,this.elements.arcLarge=a}set(){const{sweep:t,large:e}=this.command.parameters;for(const t in this.elements)this.elements[t].classList.remove("selected"),this.elements[t].setAttribute("stroke-width",this.size);let s=null;t&&e&&(s=this.elements.arcSweepLarge),t&&!e&&(s=this.elements.arcSweep),t||e||(s=this.elements.arc),!t&&e&&(s=this.elements.arcLarge),s.classList.add("selected"),s.setAttribute("stroke-width",this.selectedSize),this.element.append(s),this.elements.arcSweepLarge.setAttribute("d",this.getArc(1,1)),this.elements.arcSweep.setAttribute("d",this.getArc(0,1)),this.elements.arc.setAttribute("d",this.getArc(0,0)),this.elements.arcLarge.setAttribute("d",this.getArc(1,0))}getArc(t,e){const{p1:s,p2:i}=this,{rx:n,ry:a,angle:r}=this.command.parameters;return`M${i.x} ${i.y} A${n} ${a} ${r} ${t} ${e} ${s.x} ${s.y}`}select(){this.active||(this.active=!0,this.element.classList.add("active"),this.p1.select(),this.p2.select())}unSelect(){this.active&&(this.active=!1,this.element.classList.remove("active"),this.p1.unSelect(),this.p2.unSelect())}}class u extends l{create(){this.element=t("circle",{r:this.size}),this.element.classList.add("spe-curve-point"),this.applyClasses()}}class p extends l{create(){this.element=t("rect",{width:this.size,height:this.size,"stroke-width":.5*this.size}),this.element.classList.add("spe-end-point"),this.applyClasses()}set(){const t=s(this.size/2);this.element.setAttribute("x",s(this.x-t)),this.element.setAttribute("y",s(this.y-t)),this.update()}}class y{constructor(t,i,n){this.element=null,this.id=e(),this.p1=t,this.p2=i,this.size=s(n),this.active=!1,t.addLink(this),i.addLink(this),this.create(),this.set()}create(){this.element=t("line",{"stroke-width":this.size}),this.element.classList.add("spe-link")}set(){const t=this.p1.getArcRx?this.p1.getArcRx():this.p1.x,e=this.p1.getArcRy?this.p1.getArcRy():this.p1.y,s=this.p2.getArcRx?this.p2.getArcRx():this.p2.x,i=this.p2.getArcRy?this.p2.getArcRy():this.p2.y;this.element.setAttribute("x1",t),this.element.setAttribute("y1",e),this.element.setAttribute("x2",s),this.element.setAttribute("y2",i)}select(){this.active||(this.active=!0,this.element.classList.add("active"),this.p1.select(),this.p2.select())}unSelect(){this.active&&(this.active=!1,this.element.classList.remove("active"),this.p1.unSelect(),this.p2.unSelect())}}class g{constructor(t){this.element=null,this.id=e(),this.x=0,this.y=0,this.size=1,this.points=[],this.curvePoints=[],this.arcPoints=[],this.links=[],this.arcs=[],this.active=!1,this.lastPoint=null,this.lastModifier=null,this.create(t),this.set()}get x(){return this._x}get y(){return this._y}set x(t){this._x=s(t)}set y(t){this._y=s(t)}create(t){const e=window.getComputedStyle(t),i=t.cloneNode(),n=i.getAttributeNames(),a=parseFloat(e.strokeWidth);a&&(this.size=s(a)),n.forEach((t=>{"d"!==t&&i.removeAttribute(t)})),i.setAttribute("class","spe-path"),i.setAttribute("stroke-width",this.size),this.element=i}addPoint(t){t&&(this.points.push(t),this.lastPoint=t)}addCurvePoint(t){t&&(this.curvePoints.push(t),this.lastModifier=t)}addArcPoint(t){t&&(this.arcPoints.push(t),this.lastModifier=t)}addArc(t){t&&this.arcs.push(t)}addLink(t){t&&this.links.push(t)}getValue(){return this.element.getAttribute("d")}getLastModifier(){return this.lastModifier}getLastPoint(){return this.lastPoint}getAllPoints(){return[...this.points,...this.curvePoints,...this.arcPoints]}getElements(){return[...this.arcs,...this.links,...this.getAllPoints()]}setValue(t){this.element.setAttribute("d",t)}set(){this.points.forEach((t=>{t.x+=this.x,t.y+=this.y,t.set()})),this.curvePoints.forEach((t=>{t.x+=this.x,t.y+=this.y,t.set()}))}select(){this.active||(this.active=!0,this.element.classList.add("active"))}unSelect(){this.active&&(this.active=!1,this.element.classList.remove("active"))}}class f extends l{create(){this.element=t("polygon",{"stroke-width":.5*this.size}),this.element.classList.add("spe-start-point"),this.applyClasses()}set(){const t=s(this.size/2),e=`${s(this.x-t)} ${this.y}`,i=`${this.x} ${s(this.y+t)}`,n=`${s(this.x+t)} ${this.y}`,a=`${this.x} ${s(this.y-t)}`;this.element.setAttribute("points",`${e}, ${i}, ${n}, ${a}`),this.update()}}class x{constructor(){this.history={undo:[],redo:[]},this.historyIndex=-1,this.current=null}add(t,e="undo"){if(!t)return;let s=[];const i=[];Array.isArray(t)?s=t:s.push(t),this.current=this.current||{},s.forEach((t=>{const e={target:t,position:{x:t.x||null,y:t.y||null},angle:t.angle,command:{...t.command.parameters}};i.push(e)})),this.current[e]=i}undo(){this.canUndo()&&(this.restore(this.history.undo[this.historyIndex]),this.historyIndex--)}redo(){this.canRedo()&&(this.historyIndex++,this.restore(this.history.redo[this.historyIndex]))}restore(t){t&&t.forEach((t=>{const e=t.target;e.x=t.position.x,e.y=t.position.y,e.angle=t.angle;for(const s in e.command.parameters)e.command.parameters[s]=t.command[s];e.set()}))}isDataChanged(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!0;for(let s=0;s<t.length;s++)if(this.isDataChanged(t[s],e[s]))return!0;return!1}if(t&&"object"==typeof t&&e&&"object"==typeof e){const s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!0;for(const i of s)if("target"!==i&&this.isDataChanged(t[i],e[i]))return!0;return!1}return t!==e}save(){if(!this.current)return;const t=this.current.undo.map((t=>t.target));this.add(t,"redo");const e=this.history.undo[this.historyIndex-1],s=!e||this.isDataChanged(this.current.undo,e),i=this.isDataChanged(this.current.undo,this.current.redo);s&&i&&(this.historyIndex<this.history.undo.length-1&&(this.history.undo=this.history.undo.slice(0,this.historyIndex+1),this.history.redo=this.history.redo.slice(0,this.historyIndex+1)),this.history.undo.push(this.current.undo),this.history.redo.push(this.current.redo),this.historyIndex++),this.current=null}canUndo(){return this.historyIndex>=0}canRedo(){return this.historyIndex<this.history.redo.length-1}}class v{static CLASSNAME="svg-path-editor";static instances=[];static handleMouseDown(t){v.instances.forEach((e=>e.onMouseDown(t)))}static handleMouseMove(t){v.instances.forEach((e=>e.onMouseMove(t)))}static handleMouseUp(t){v.instances.forEach((e=>e.onMouseUp(t)))}static handleKeyDown(t){v.instances.forEach((e=>e.onKeyDown(t)))}static handleKeyUp(t){v.instances.forEach((e=>e.onKeyUp(t)))}constructor(t){v.instances.push(this),this.options={container:null,path:null,...t},this.path=this.options.path,this.container=this.options.container,this.keyModifierPressed={},this.pointDragging={active:!1,target:null},this.pathDragging={active:!1},this.elements={svgParents:i(this.container)},this.history=new x,this.pathSize=0,this.snapRotation=90,this.snapDistance=5,this.init()}isActive(){const t=this.elements.path;if(t.active)return!0;for(const e of t.points)if(e.active)return!0;return!1}init(){1===v.instances.length&&(document.addEventListener("mousedown",v.handleMouseDown),document.addEventListener("mousemove",v.handleMouseMove),document.addEventListener("mouseup",v.handleMouseUp),document.addEventListener("keydown",v.handleKeyDown),document.addEventListener("keyup",v.handleKeyUp));const t=this.createEditor();this.elements.element=t.element,this.elements.path=t.path}createEditor(){const e=t("g"),s=new g(this.path);return e.classList.add(v.CLASSNAME),e.appendChild(s.element),{element:e,path:s}}setScaleAndOffset(){const t=n(this.container);for(let e=this.elements.svgParents.length-1;0===e;e--){const s=n(this.elements.svgParents[e]);t.scale.x*=s.scale.x,t.scale.y*=s.scale.y,t.offset.x=t.offset.x*s.scale.x+s.offset.x,t.offset.y=t.offset.y*s.scale.y+s.offset.y}this.scale=t.scale,this.viewBoxOffset=t.offset,this.bounding=t.bounding}getPoint(t){const e=this.elements.path.getAllPoints();for(const s of e)if(s.element===t)return s;return!1}getPath(t){const e=this.elements.path;return e.element===t&&e}snapAngle(t){const e=t%this.snapRotation;return e<this.snapDistance?t-e:this.snapRotation-e<this.snapDistance?t+(this.snapRotation-e):t}getScaledPosition(t){return{x:(t.clientX-this.bounding.left)*this.scale.x+this.viewBoxOffset.x,y:(t.clientY-this.bounding.top)*this.scale.y+this.viewBoxOffset.y}}onMouseDown(t){if(2===t.button)return!1;const e=this.getPoint(t.target),s=this.getPath(t.target);if(this.elements.path.points.forEach((t=>{e&&(e===t||e.linkedTo(t))?t.select():t.unSelect()})),s||this.elements.path.unSelect(),!e&&!s)return!1;this.setScaleAndOffset();const i=this.getScaledPosition(t);s?(s.select(),this.pathDragging={active:!0,target:s,offsetX:i.x,offsetY:i.y},this.history.add(s.points)):(this.elements.path.unSelect(),this.pointDragging={active:!0,target:e,offsetX:i.x-e.x,offsetY:i.y-e.y},this.history.add(e))}onMouseMove(t){const e=this.pathDragging.active,s=e?this.pathDragging:this.pointDragging;if(!s.active)return;const i=s.target,n=this.getScaledPosition(t),a=n.x-s.offsetX,r=n.y-s.offsetY;e?(i.x=this.keyModifierPressed.alt?0:a,i.y=this.keyModifierPressed.shift?0:r,i.set(),s.offsetX=n.x,s.offsetY=n.y):(i.isHorizontal&&!this.keyModifierPressed.alt&&(i.x=a),i.isVertical&&!this.keyModifierPressed.shift&&(i.y=r),i.isAngle&&(i.angle=this.snapAngle(function(t,e){const s=e.x-t.x,i=e.y-t.y,n=(Math.atan2(i,s)*(180/Math.PI)+90)%360;return n<0?n+360:n}(i.centerPoint,{x:a,y:r}))),i.set()),this.updatePath()}onMouseUp(t){const e=this.getPoint(t.target);2===t.button?this.onContextMenu(e):(this.pathDragging={active:!1,target:null,offsetX:0,offsetY:0},this.pointDragging={active:!1,target:null,offsetX:0,offsetY:0}),this.history.save()}onContextMenu(t){t&&t.active&&(this.keyModifierPressed.shift?t.arcs.forEach((e=>{e.p1===t&&(this.history.add(e),e.triggerSweep())})):(this.history.add(t),t.arcs.forEach((e=>{e.p1===t&&(this.history.add(e),e.triggerLarge())}))),this.updatePath())}onKeyDown(t){const{ctrlKey:e,shiftKey:s}=t,{shift:i,z:n,y:a,c:r}=this.keyModifierPressed,h=this.elements.path,o=t.key.toLowerCase(),c=this.isActive();this.updateKeyModifiers(t),e&&"c"===o&&c&&!r?function(t){if(navigator.clipboard)return navigator.clipboard.writeText(t);{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select();try{const t=document.execCommand("copy");return document.body.removeChild(e),t?Promise.resolve():Promise.reject()}catch(t){return document.body.removeChild(e),Promise.reject(t)}}}(h.getValue()):e&&"z"===o&&c&&!n?(this.history.undo(),this.updatePath()):e&&"y"===o&&c&&!a?(this.history.redo(),this.updatePath()):e&&s&&!i&&this.togglePointsSelection()}onKeyUp(t){this.updateKeyModifiers(t)}updateKeyModifiers(t){const{ctrlKey:e,shiftKey:s,altKey:i}=t,n=t.key.toLowerCase();i&&t.preventDefault(),this.keyModifierPressed={...this.keyModifierPressed,ctrl:e,shift:s,alt:i,[n]:"keydown"===t.type}}togglePointsSelection(){const t=this.elements.path,e=t.points.filter((t=>t.active)).length===t.points.length;t.points.forEach((s=>{e?s.unSelect():(t.unSelect(),s.select())}))}updatePath(){const t=this.elements.path,{commands:e}=this.options;t.getAllPoints().forEach((t=>{const e=t.command.getAbsolute(),s=t.commandParams;s.x&&(t.x=e[s.x]),s.y&&(t.y=e[s.y]),t.set()})),this.elements.path.setValue(e.build())}addStartPoint(t,e,s){const i=this.elements.path,n=new f(t,e,1.5*i.size,s);i.addPoint(n)}addEndPoint(t,e,s){const i=this.elements.path,n=new p(t,e,1.2*i.size,s);i.addPoint(n)}addPoint(t,e,s){const i=this.elements.path,n=new l(t,e,.8*i.size,s);i.addPoint(n)}addCurvePoint(t,e,s){const i=this.elements.path,n=new u(t,e,.6*i.size,s);i.addCurvePoint(n)}addArcPoint(t,e){const s=this.elements.path,i=new d(t,.6*s.size,e);s.addArcPoint(i)}addArc(t,e,s){const i=this.elements.path,n=new m(t,e,i.size,s);i.addArc(n)}addLink(){const t=this.elements.path,[e,s]=[t.getLastModifier(),t.getLastPoint()],i=new y(e,s,.9*t.size);t.addLink(i)}build(){const{element:t,path:e}=this.elements;e.getElements().forEach((e=>{t.append(e.element)})),this.container.append(t)}destroy(){0===v.instances.length&&(document.removeEventListener("mousedown",v.handleMouseDown),document.removeEventListener("mousemove",v.handleMouseMove),document.removeEventListener("mouseup",v.handleMouseUp),document.removeEventListener("keydown",v.handleKeyDown),document.removeEventListener("keyup",v.handleKeyUp)),this.elements.element.remove()}}const A="svg-path-helper";let P=null;class w{constructor(){if(P)return P;this.commandHandlers=this.initCommandHandlers(),this.list=[],this.current={},P=this}getPaths(t){let e=Array.from(t.querySelectorAll("path"));return e=e.filter((e=>{if(e.closest(`.${v.CLASSNAME}`))return!1;if(e.closest("svg")!==t)return!1;for(const t of this.list){if(t.paths.filter((t=>t.element===e)).length>0)return!1}return!0})),e.map(L).filter(Boolean)}add(t,s=e()){let i=[];t instanceof SVGElement&&t.classList.contains(A)?i.push({name:s,container:t,element:t,paths:this.getPaths(t)}):t.querySelectorAll(`svg.${A}, svg.${A} svg`).forEach((e=>{i.push({name:s,container:t,element:e,paths:this.getPaths(e)})})),i=i.filter((t=>t.element&&t.paths.length>0)),this.list.push(...i),this.draw(i)}remove(t){this.list.forEach((e=>{e.container===t&&this.removeByHelper(e)}))}removeByName(t){this.list.forEach((e=>{e.name===t&&this.removeByHelper(e)}))}removeByPath(t){this.list.forEach((e=>{e.paths.forEach((e=>{e.element===t&&e.editor.destroy()}))}))}removeByHelper(t){const e=this.list.indexOf(t);e>-1&&(t.paths.forEach((t=>t.editor.destroy())),this.list.splice(e,1))}clear(){this.list.forEach((t=>this.removeByHelper(t))),this.list.length=0}initCommandHandlers(){return{M:this.pointHandler,L:this.pointHandler,T:this.pointHandler,H:this.pointHandler,V:this.pointHandler,S:this.curveHandler,Q:this.curveHandler,C:this.cubicBezierHandler,A:this.arcHandler}}draw(t){t.forEach((t=>{t.paths.forEach((t=>this.drawPath(t)))}))}drawPath(t){const e=t.element,s=new v({container:e.parentNode,path:e,commands:t.commands}),i=t.commands.list.length;t.commands.list.forEach(((t,e)=>{const n=this.commandHandlers[t.name];this.current={command:t,index:e,editor:s,length:i},n&&n.call(this)})),s.build(),t.editor=s}pointHandler(){const{command:t}=this.current,{x:e,y:s}=t.getAbsolute();this.addPoint(e,s,{command:t,params:{x:"x",y:"y"}})}curveHandler(){const{command:t,editor:e}=this.current,{x:s,y:i,x1:n,y1:a}=t.getAbsolute();e.addCurvePoint(n,a,{command:t,params:{x:"x1",y:"y1"}}),this.addPoint(s,i,{command:t,params:{x:"x",y:"y"}}),e.addLink()}cubicBezierHandler(){const{command:t,editor:e}=this.current,{x:s,y:i,x1:n,y1:a,x2:r,y2:h}=t.getAbsolute();e.addCurvePoint(n,a,{command:t,params:{x:"x1",y:"y1"}}),e.addLink(),e.addCurvePoint(r,h,{command:t,params:{x:"x2",y:"y2"}}),this.addPoint(s,i,{command:t,params:{x:"x",y:"y"}}),e.addLink()}arcHandler(){const{command:t,editor:e}=this.current,{x:s,y:i}=t.getAbsolute(),n=e.elements.path,a=n.getLastPoint();this.addPoint(s,i,{command:t,params:{x:"x",y:"y"}});const r=n.getLastPoint();e.addArc(r,a,{command:t,params:{x:"rx",y:"ry"}}),e.addArcPoint(r,{command:t,params:{x:"rx"}}),e.addLink(),e.addArcPoint(r,{command:t,params:{y:"ry"}}),e.addLink(),e.addArcPoint(r,{command:t,params:{angle:"angle"}}),e.addLink()}addPoint(t,e,s){const{editor:i,index:n,length:a}=this.current;0===n?i.addStartPoint(t,e,s):n===a-1?i.addEndPoint(t,e,s):i.addPoint(t,e,s)}}function L(t){const e=t.getAttribute("d");return e&&e.trim()?{element:t,commands:new c(e)}:null}export{w as default};
